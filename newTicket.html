<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
        "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta http-equiv="Content-type" content="text/html;charset=UTF-8" />
<title>New Ticket</title>
</head>
<body>
<form id="new-ticket">
  Please fill in the form below to open a new ticket.<br /><br />
  <label for="name">Full Name:</label><input type="text" id="name"></input><br />
  <label for="email">Email:</label><input type="text" id="email"></input><br />
  <label for="phone">Phone:</label><input type="text" id="phone"></input><br />
  <label for="help-topic">Help Topic</label><select id="help-topic">
    <option value="none">None</option>
  </select><br />
  <label for="subject">Subject:</label><input type="text" id="subject"></input><br />
  <label for="message">Message:</label><textarea rows="6" cols="60" id="message"></textarea><br />
  <label for="attachment">Attachment:</label><input type="file" id="attachment"></input><br />
  <br />
  <input type="button" id="submit-ticket" value="Submit Ticket"></input>
  <input type="button" id="reset-ticket" value="Reset"></input>
  <input type="button" id="cancel-ticket" value="Cancel"></input>
</form>
<script src="../yui/build/yui/yui-debug.js" type="text/javascript"></script>
<script src="wut.js"></script>
<script type="text/javascript">
var init = function(Y, WUT) {
  
  var submitTicket = function(e) {
    var TICKET = {name:"0", email:"1", phone:"2", helpTopic:"3", subject:"4", createDate:"5", status:"6"},
        ticket = [];
    ticket[TICKET.name] = Y.Node.get("#name").getAttrs().value;
    ticket[TICKET.email] = Y.Node.get("#email").getAttrs().value;
    ticket[TICKET.phone] = Y.Node.get("#phone").getAttrs().value;
    ticket[TICKET.helpTopic] = Y.Node.get("#help-topic").getAttrs().value;
    ticket[TICKET.subject] = Y.Node.get("#subject").getAttrs().value;
    ticket[TICKET.createDate] = Y.DataType.Date.format(new Date(), {format:"%Y-%m-%d %T"});
    ticket[TICKET.status] = "open";

    WUT.put({resource: "flat"}, {table:'ticket', values:ticket}, ticketSuccess);
  };

  var ticketSuccess = function(id, o, a) {
    var lastId = o.result,
        COMMENT = {ticketId:"0", createDate:"1", text:"2", name:"3"},
        comment = [];
    comment[COMMENT.ticketId] = lastId;
    comment[COMMENT.createDate] = Y.DataType.Date.format(new Date(), {format:"%Y-%m-%d %T"});
    comment[COMMENT.text] = Y.Node.get("#message").getAttrs().value;
    comment[COMMENT.name] = "NULL NAME";

    WUT.put({resource: "flat"}, {table:'message', values:comment}, function(id, o, a, b) {
      if(b.lastId) {
        document.location = "http://api.webutilitykit.com:8000/html/pages/viewTicket.html?ticket=" + b.lastId;
      }
    }, {lastId: lastId});
  };
  
  Y.on("click", submitTicket, "#submit-ticket", null, Y, WUT);
};

WUT(init);

</script>
</body>
</html>
